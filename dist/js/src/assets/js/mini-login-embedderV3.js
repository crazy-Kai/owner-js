var json_parse=function(){"use strict";var at,ch,text,value,escapee={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},error=function(m){throw{name:"SyntaxError",message:m,at:at,text:text}},next=function(c){return c&&c!==ch&&error("Expected '"+c+"' instead of '"+ch+"'"),ch=text.charAt(at),at+=1,ch},number=function(){var number,string="";for("-"===ch&&(string="-",next("-"));ch>="0"&&ch<="9";)string+=ch,next();if("."===ch)for(string+=".";next()&&ch>="0"&&ch<="9";)string+=ch;if("e"===ch||"E"===ch)for(string+=ch,next(),"-"!==ch&&"+"!==ch||(string+=ch,next());ch>="0"&&ch<="9";)string+=ch,next();return number=+string,isFinite(number)?number:void error("Bad number")},string=function(){var hex,i,uffff,string="";if('"'===ch)for(;next();){if('"'===ch)return next(),string;if("\\"===ch)if(next(),"u"===ch){for(uffff=0,i=0;i<4&&(hex=parseInt(next(),16),isFinite(hex));i+=1)uffff=16*uffff+hex;string+=String.fromCharCode(uffff)}else{if("string"!=typeof escapee[ch])break;string+=escapee[ch]}else string+=ch}error("Bad string")},white=function(){for(;ch&&ch<=" ";)next()},word=function(){switch(ch){case"t":return next("t"),next("r"),next("u"),next("e"),!0;case"f":return next("f"),next("a"),next("l"),next("s"),next("e"),!1;case"n":return next("n"),next("u"),next("l"),next("l"),null}error("Unexpected '"+ch+"'")},array=function(){var array=[];if("["===ch){if(next("["),white(),"]"===ch)return next("]"),array;for(;ch;){if(array.push(value()),white(),"]"===ch)return next("]"),array;next(","),white()}}error("Bad array")},object=function(){var key,object={};if("{"===ch){if(next("{"),white(),"}"===ch)return next("}"),object;for(;ch;){if(key=string(),white(),next(":"),Object.hasOwnProperty.call(object,key)&&error('Duplicate key "'+key+'"'),object[key]=value(),white(),"}"===ch)return next("}"),object;next(","),white()}}error("Bad object")};return value=function(){switch(white(),ch){case"{":return object();case"[":return array();case'"':return string();case"-":return number();default:return ch>="0"&&ch<="9"?number():word()}},function(source,reviver){var result;return text=source,at=0,ch=" ",result=value(),white(),ch&&error("Syntax error"),"function"==typeof reviver?function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}({"":result},""):result}}();!function(){window.MiniLoginEmbedder||(window.MiniLoginEmbedder=function(){return this.config={targetId:"alibaba-login-iframe",appKey:"",lang:"zh_CN",cssLink:"",styleType:"vertical",beforeSubmitBtnHtml:"",afterSubmitBtnHtml:"",bizParams:"",queryStr:"",resizeIframeWidthFix:!1,resizeIframeHeightFix:!1,loginId:null,iframeWidth:250,iframeHeight:250,notLoadSsoView:!1,notKeepLogin:!1,isMobile:!1},this.temp={target:null,iframe:null},this._listeners={},this._hashCodeCounter=0,this._messageType=null,this._bakWindowName=window.name,this._windowNameHash=null,this._windowNameTimer=null,this},window.MiniLoginEmbedder.prototype={merge:function(){for(var src,mergeObj={},args=Array.prototype.slice.call(arguments),i=0;src=args[i++];)for(var key in src)mergeObj[key]=src[key];return mergeObj},json2str:function(obj){switch(obj.constructor){case Object:var str="{";for(var o in obj)obj[o]&&(str+='"'+o+'":'+arguments.callee(obj[o])+",");return","==str.substr(str.length-1)&&(str=str.substr(0,str.length-1)),str+"}";case Array:var str="[";for(var o in obj)str+=arguments.callee(obj[o])+",";return","==str.substr(str.length-1)&&(str=str.substr(0,str.length-1)),str+"]";default:return'"'+obj.toString()+'"'}},toQueryPair:function(key,value){return"undefined"==typeof value?key:key+"="+encodeURIComponent(null===value?"":String(value))},toQueryString:function(obj){var _self=this,ret=[];for(var key in obj){key=encodeURIComponent(key);var values=obj[key];if(values&&values.constructor==Array){for(var value,queryValues=[],i=0,len=values.length;i<len;i++)value=values[i],queryValues.push(_self.toQueryPair(key,value));ret=ret.concat(queryValues)}else ret.push(_self.toQueryPair(key,values))}return ret.join("&")},get:function(domOrId){return"string"==typeof domOrId?document.getElementById(domOrId):domOrId},hasClass:function(el,cls){return el.className.match(new RegExp("(\\s|^)"+cls+"(\\s|$)"))},addClass:function(el,cls){return""===el.className?void(el.className=cls):void(this.hasClass(el,cls)||(el.className+=" "+cls))},removeClass:function(el,cls){if(this.hasClass(el,cls)){var reg=new RegExp("(\\s|^)"+cls+"(\\s|$)");el.className=el.className.replace(reg," ")}},on:function(domOrId,type,fn){var obj=this.get(domOrId);obj.attachEvent?(obj["e"+type+fn]=fn,obj[type+fn]=function(){obj["e"+type+fn](window.event)},obj.attachEvent("on"+type,obj[type+fn])):obj.addEventListener(type,fn,!1)},addEvent:function(sType,fnHandle){if("function"==typeof fnHandle){var ls=this._listeners[sType];ls||(ls=this._listeners[sType]={}),ls[this._toHashCode(fnHandle)]=fnHandle}},fireEvent:function(sType,args){if(this._listeners[sType])for(var hc in this._listeners[sType])this._listeners[sType][hc].call(this,args)},_toHashCode:function(o){return o._hashCode?o._hashCode:o._hashCode="_"+(this._hashCodeCounter++).toString(32)},_tempOnInit:function(){this.temp.target=this.get(this.config.targetId)},_parseWindowNameData:function(windowNameVal){var oData=windowNameVal.split("[@]").pop().split("[login-iframe-message]");return{origin:oData[0],data:oData[1]}},init:function(customConfig){this.config=this.merge(this.config,customConfig||{});var _self=this,temp=(this.config,this.temp);_self._tempOnInit(),_self._renderIframe(),window.postMessage?(_self._messageType="postMessage",_self.on(window,"message",function(oEvent){_self.messageHanlder.call(_self,oEvent)})):(_self._messageType="windowName",window.name="",_self._windowNameHash="",_self._windowNameTimer=setInterval(function(){""!==window.name&&window.name.indexOf("[login-iframe-message]")!==-1&&window.name!=_self._windowNameHash&&(_self._windowNameHash=window.name,_self.messageHanlder(_self._parseWindowNameData(window.name)))},50)),_self.on(window,"beforeunload",function(oEvent){temp.iframe.style.visibility="hidden"}),this.fireEvent("onInit",{_self:this}),this.free()},messageHanlder:function(oEvent){var _self=this,config=this.config,temp=this.temp,oData=json_parse(decodeURIComponent(oEvent.data));switch(oData.showIframe&&("visible"!==temp.iframe.style.visibility&&(temp.iframe.style.visibility="visible"),this.fireEvent("onIframeShow",{_self:temp.iframe}),_self.addClass(temp.target,"iframe-show")),oData.hideIframe&&("hidden"!==temp.iframe.style.visibility&&(temp.iframe.style.visibility="hidden"),this.fireEvent("onIframeHide",{_self:temp.iframe}),_self.removeClass(temp.target,"iframe-show")),oData.action){case"resizeIframe":if(0==temp.iframe.offsetHeight)return;config.resizeIframeWidthFix||(temp.iframe.width=oData.width),config.resizeIframeHeightFix||(temp.iframe.height=oData.height),_self._bakOriginalIframeWidth||(config.resizeIframeWidthFix||(_self._originalIframeWidth=oData.width),config.resizeIframeHeightFix||(_self._originalIframeHeight=oData.height),_self._bakOriginalIframeWidth=!0);break;case"otherAction":}this.fireEvent("onMessage",oData)},restoreOriginalWidth:function(){this.iframe.width=this._originalIframeWidth},restoreOriginalHeight:function(){this.iframe.height=this._originalIframeHeight},_renderIframe:function(){var iframeQueryParam,_self=this,config=this.config,temp=this.temp,target=temp.target,iframe=this.temp.iframe=document.createElement("iframe");iframeQueryParam={lang:config.lang,appKey:config.appKey,styleType:config.styleType,bizParams:config.bizParams,notLoadSsoView:config.notLoadSsoView,notKeepLogin:config.notKeepLogin,isMobile:config.isMobile},config.loginId&&(iframeQueryParam.loginId=config.loginId),iframe.id="alibaba-login-box",iframe.src=config.iframeUrl+"?"+_self.toQueryString(iframeQueryParam)+_self.config.queryStr+"&rnd="+Math.random(),iframe.width=config.iframeWidth,iframe.height=config.iframeHeight,iframe.frameBorder="none",iframe.scrolling="no",iframe.style.border="none",_self.on(iframe,"load",function(){_self.addClass(target,"iframe-loaded")}),target.appendChild(iframe),this.fireEvent("afterRenderIframe",{iframe:iframe})},free:function(){/msie/i.test(navigator.userAgent)&&CollectGarbage()},sleep:function(){"windowName"===_self._messageType&&(clearInterval(_self._windowNameTimer),window.name=this._bakWindowName),this.free()},destory:function(){"windowName"===_self._messageType&&(clearInterval(_self._windowNameTimer),window.name=this._bakWindowName),this.free()}})}();